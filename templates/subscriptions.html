<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Subscriptions</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 40px;
        margin-bottom: 80px; /* Space for sticky button bar */
      }

      h1 {
        color: #667eea;
        font-size: 2.5em;
        margin-bottom: 30px;
        text-align: center;
      }

      .subscription-card {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
        transition: all 0.3s ease;
        display: flex;
        gap: 15px;
        align-items: start;
      }

      .subscription-card:hover {
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        transform: translateY(-2px);
      }

      .subscription-content[style*="cursor: pointer"]:hover {
        background: #f0f4ff;
      }

      .subscription-card[style*="cursor: pointer"]:hover {
        border-color: #ffc107;
        box-shadow: 0 6px 16px rgba(255, 193, 7, 0.3);
        transform: translateY(-3px);
      }

      .subscription-card[style*="border-color: #28a745"]:hover {
        border-color: #218838;
        box-shadow: 0 6px 16px rgba(40, 167, 69, 0.3);
        transform: translateY(-3px);
      }

      .subscription-card input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
        margin-top: 4px;
        accent-color: #667eea;
      }

      .subscription-content {
        flex: 1;
      }

      .subscription-name {
        font-size: 1.2em;
        font-weight: 600;
        color: #2d3748;
        margin-bottom: 10px;
      }

      .subscription-meta {
        display: flex;
        gap: 20px;
        margin-bottom: 10px;
        flex-wrap: wrap;
      }

      .badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: 600;
      }

      .confidence-high {
        background: #d4edda;
        color: #155724;
      }

      .confidence-medium {
        background: #fff3cd;
        color: #856404;
      }

      .confidence-low {
        background: #f8d7da;
        color: #721c24;
      }

      .frequency-badge {
        background: #d1ecf1;
        color: #0c5460;
      }

      .subscription-examples {
        font-size: 0.9em;
        color: #6c757d;
        margin-top: 8px;
        line-height: 1.5;
      }

      .button-group {
        display: flex;
        gap: 12px;
        margin-top: 30px;
        flex-wrap: wrap;
      }

      .sticky-button-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        padding: 16px 20px;
        box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        display: flex;
        gap: 12px;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        border-top: 2px solid #e9ecef;
      }

      .sticky-button-bar button {
        min-width: 180px;
      }

      .selection-counter {
        font-weight: 600;
        color: #667eea;
        font-size: 1em;
        padding: 8px 16px;
        background: #f0f4ff;
        border-radius: 8px;
        margin-right: auto;
      }

      button {
        padding: 12px 28px;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .btn-scan {
        background: #28a745;
        color: white;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
      }

      .empty-state p {
        font-size: 1.2em;
        margin-bottom: 20px;
      }

      .back-link {
        display: inline-block;
        margin-top: 20px;
        color: #667eea;
        text-decoration: none;
        font-weight: 600;
      }

      .back-link:hover {
        text-decoration: underline;
      }

      /* Toast Notifications */
      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 300px;
        opacity: 0;
        transform: translateX(400px);
        transition: all 0.3s ease;
        z-index: 10000;
      }

      .toast.show {
        opacity: 1;
        transform: translateX(0);
      }

      .toast.success {
        border-left: 4px solid #28a745;
      }

      .toast.error {
        border-left: 4px solid #dc3545;
      }

      .toast.info {
        border-left: 4px solid #667eea;
      }

      .toast-icon {
        font-size: 24px;
      }

      .toast-message {
        flex: 1;
        color: #2d3748;
      }

      /* Modal */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9999;
        align-items: center;
        justify-content: center;
      }

      .modal-overlay.show {
        display: flex;
      }

      .modal {
        background: white;
        border-radius: 12px;
        padding: 30px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.3s ease;
      }

      @keyframes modalSlideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-title {
        font-size: 1.5em;
        margin-bottom: 15px;
        color: #2d3748;
      }

      .modal-message {
        margin-bottom: 25px;
        color: #6c757d;
        line-height: 1.5;
      }

      .modal-buttons {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
      }

      .modal-btn {
        padding: 10px 24px;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .modal-btn-cancel {
        background: #e9ecef;
        color: #6c757d;
      }

      .modal-btn-cancel:hover {
        background: #dee2e6;
      }

      .modal-btn-confirm {
        background: #667eea;
        color: white;
      }

      .modal-btn-confirm:hover {
        background: #5568d3;
      }

      /* Scanning Overlay */
      .scanning-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(102, 126, 234, 0.95);
        z-index: 10001;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .scanning-overlay.show {
        display: flex;
      }

      .scanning-content {
        text-align: center;
        color: white;
      }

      .spinner {
        width: 80px;
        height: 80px;
        margin: 0 auto 30px;
        border: 8px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .scanning-text {
        font-size: 1.8em;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .scanning-subtitle {
        font-size: 1.1em;
        opacity: 0.9;
      }

      /* Progress Bar */
      .progress-container {
        width: 400px;
        max-width: 90%;
        margin: 30px auto 20px;
      }

      .progress-bar {
        width: 100%;
        height: 30px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        overflow: hidden;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #fff 0%, #f0f0f0 100%);
        border-radius: 15px;
        transition: width 0.5s ease-out;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        color: #667eea;
        font-size: 0.9em;
      }

      .progress-stats {
        font-size: 1em;
        opacity: 0.95;
        margin-top: 15px;
        line-height: 1.6;
      }

      .time-remaining {
        font-size: 1.1em;
        font-weight: 600;
        margin-top: 10px;
      }

      @media (max-width: 600px) {
        .container {
          padding: 20px;
          margin-bottom: 100px; /* More space for sticky bar on mobile */
        }

        h1 {
          font-size: 1.8em;
        }

        .subscription-meta {
          flex-direction: column;
          gap: 8px;
        }

        .button-group {
          flex-direction: column;
        }

        .sticky-button-bar {
          flex-direction: column;
          padding: 12px;
        }

        .selection-counter {
          margin-right: 0;
          width: 100%;
          text-align: center;
          margin-bottom: 8px;
        }

        .sticky-button-bar button {
          width: 100%;
          min-width: auto;
        }

        button {
          width: 100%;
        }

        .toast {
          right: 10px;
          left: 10px;
          min-width: auto;
        }

        .modal {
          width: 95%;
          padding: 20px;
        }

        .modal-buttons {
          flex-direction: column;
        }

        .modal-btn {
          width: 100%;
        }

        .scanning-text {
          font-size: 1.4em;
        }

        .scanning-subtitle {
          font-size: 1em;
          padding: 0 20px;
        }

        .progress-container {
          width: 95%;
        }

        .progress-stats {
          font-size: 0.9em;
        }

        .time-remaining {
          font-size: 1em;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üìß Email Subscriptions</h1>
      {% if groups %}
      <p style="color: #6c757d; margin-bottom: 25px; text-align: center">
        üí° Click on any subscription to view unsubscribe URLs and details
      </p>
      <form id="unsubscribe-form">
        {% for g in groups %}
        <div class="subscription-card">
          <input type="checkbox" name="group_ids" value="{{ g.id }}" />
          <div
            class="subscription-content"
            style="cursor: pointer"
            onclick="showSubscriptionDetails({{ g.id }}, event)"
          >
            <div class="subscription-name">
              {{ g.sender_name or g.sender_domain }}
            </div>
            <div class="subscription-meta">
              {% if g.confidence_score >= 70 %}
              <span class="badge confidence-high"
                >Confidence: {{ g.confidence_score }}%</span
              >
              {% elif g.confidence_score >= 40 %}
              <span class="badge confidence-medium"
                >Confidence: {{ g.confidence_score }}%</span
              >
              {% else %}
              <span class="badge confidence-low"
                >Confidence: {{ g.confidence_score }}%</span
              >
              {% endif %}
              <span class="badge frequency-badge"
                >{{ g.frequency_score }} emails</span
              >
            </div>
            <div class="subscription-examples">
              <strong>Examples:</strong> {{ g.example_subjects|join(', ') }}
            </div>
          </div>
        </div>
        {% endfor %}
      </form>

      <!-- Sticky button bar at bottom -->
      <div class="sticky-button-bar">
        <div class="selection-counter" id="selectionCounter">0 selected</div>
        <button
          type="button"
          class="btn-danger"
          onclick="submitUnsubscribe(event)"
        >
          ‚úâÔ∏è Unsubscribe Selected
        </button>
        <button
          type="button"
          class="btn-secondary"
          onclick="removeFromList(event)"
        >
          üóëÔ∏è Remove from List
        </button>
      </div>

      <script>
        // Update selection counter
        function updateSelectionCounter() {
          const form = document.getElementById("unsubscribe-form");
          if (form) {
            const count = form.querySelectorAll(
              'input[name="group_ids"]:checked',
            ).length;
            const counter = document.getElementById("selectionCounter");
            if (counter) {
              counter.textContent =
                count === 1 ? "1 selected" : `${count} selected`;
            }
          }
        }

        // Add change listener to all checkboxes
        document.addEventListener("DOMContentLoaded", function () {
          const form = document.getElementById("unsubscribe-form");
          if (form) {
            form.addEventListener("change", updateSelectionCounter);
          }
        });
        async function submitUnsubscribe(event) {
          const form = document.getElementById("unsubscribe-form");
          const checkboxes = Array.from(
            form.querySelectorAll('input[name="group_ids"]:checked'),
          );
          const data = checkboxes.map((n) => parseInt(n.value));

          if (!data.length) {
            showToast(
              "Please select at least one subscription to unsubscribe.",
              "error",
            );
            return;
          }

          const btn = event.target;
          showModal(
            "Confirm Unsubscribe",
            `Are you sure you want to unsubscribe from ${data.length} subscription(s)?`,
            async () => {
              // Disable button and show loading state
              btn.disabled = true;
              btn.textContent = "Processing...";

              try {
                const resp = await fetch("/execute_unsubscribe", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ groups: data }),
                });
                const j = await resp.json();

                // Show user-friendly message
                if (j.ok) {
                  showToast(
                    `Unsubscribe request sent for ${data.length} subscription(s). This is processed in the background.`,
                    "success",
                  );
                  // Remove the selected items from UI immediately
                  setTimeout(() => {
                    checkboxes.forEach((cb) => {
                      const div = cb.closest(".subscription-card");
                      if (div) div.remove();
                    });
                    updateSelectionCounter();
                  }, 500);
                } else {
                  showToast(j.error || "Unknown error occurred", "error");
                }
              } catch (err) {
                showToast(`Network error: ${err.message}`, "error");
              } finally {
                btn.disabled = false;
                btn.textContent = "‚úâÔ∏è Unsubscribe Selected";
              }
            },
          );
        }

        async function removeFromList(event) {
          const form = document.getElementById("unsubscribe-form");
          const checkboxes = Array.from(
            form.querySelectorAll('input[name="group_ids"]:checked'),
          );
          const data = checkboxes.map((n) => parseInt(n.value));

          if (!data.length) {
            showToast(
              "Please select at least one subscription to remove.",
              "error",
            );
            return;
          }

          const btn = event.target;
          showModal(
            "Remove from List",
            `Remove ${data.length} subscription(s) from the list without unsubscribing?`,
            async () => {
              btn.disabled = true;
              btn.textContent = "Removing...";

              try {
                const resp = await fetch("/remove_from_list", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({ groups: data }),
                });
                const j = await resp.json();

                if (j.ok) {
                  showToast(
                    `Removed ${j.deleted} subscription(s) from the list.`,
                    "success",
                  );
                  // Remove from UI
                  setTimeout(() => {
                    checkboxes.forEach((cb) => {
                      const div = cb.closest(".subscription-card");
                      if (div) div.remove();
                    });
                    updateSelectionCounter();
                  }, 500);
                } else {
                  showToast(j.error || "Unknown error occurred", "error");
                }
              } catch (err) {
                showToast(`Network error: ${err.message}`, "error");
              } finally {
                btn.disabled = false;
                btn.textContent = "üóëÔ∏è Remove from List";
              }
            },
          );
        }
      </script>
      {% else %}
      <div class="empty-state">
        <p>üì≠ No subscriptions detected yet.</p>
      </div>
      {% endif %}

      <div class="button-group" style="margin-top: 30px">
        <button class="btn-scan" onclick="startScan()">üîç Scan Mailbox</button>
      </div>
      <div style="text-align: center">
        <a href="/" class="back-link">‚Üê Back to Home</a>
      </div>
      <script>
        async function startScan() {
          showModal(
            "Start Scan",
            "Start scanning your mailbox for subscriptions? This will scan up to 500 emails. On subsequent scans, only new emails will be checked.",
            async () => {
              showScanning();
              try {
                const resp = await fetch("/start_scan", { method: "POST" });
                const j = await resp.json();
                if (j.ok) {
                  // Start polling for progress
                  pollScanProgress();
                } else {
                  hideScanning();
                  showToast(j.error || "Unknown error", "error");
                }
              } catch (err) {
                hideScanning();
                showToast(`Network error: ${err.message}`, "error");
              }
            },
          );
        }

        let pollInterval = null;
        let scanStartTime = null;

        async function pollScanProgress() {
          if (pollInterval) clearInterval(pollInterval);
          scanStartTime = Date.now();

          pollInterval = setInterval(async () => {
            try {
              const resp = await fetch("/scan_progress");
              const data = await resp.json();

              if (data.ok) {
                updateProgress(data);

                if (!data.is_scanning) {
                  // Scan complete
                  clearInterval(pollInterval);
                  pollInterval = null;
                  hideScanning();

                  // Show results message
                  const newSubs = data.new_subscriptions || 0;
                  const totalScanned = data.total_scanned || data.current;

                  if (totalScanned === 0) {
                    showToast(
                      "Scan complete! No new emails to scan.",
                      "success",
                    );
                  } else {
                    let message = `Scan complete! Processed ${totalScanned.toLocaleString()} emails.`;

                    if (newSubs === 0) {
                      message += " No new subscriptions found.";
                    } else if (newSubs === 1) {
                      message += " Found 1 new subscription!";
                    } else {
                      message += ` Found ${newSubs} new subscriptions!`;
                    }

                    showToast(message, "success");
                  }

                  setTimeout(() => {
                    window.location.reload();
                  }, 2000);
                }
              }
            } catch (err) {
              console.error("Error polling progress:", err);
            }
          }, 1000); // Poll every second
        }

        function updateProgress(data) {
          const percent = data.percent || 0;
          const current = data.current || 0;
          const total = data.total || 0;

          // Update progress bar
          const progressFill = document.getElementById("progressFill");
          progressFill.style.width = percent + "%";
          progressFill.textContent = percent + "%";

          // Update progress text
          const progressText = document.getElementById("progressText");
          progressText.textContent = `Scanned ${current.toLocaleString()} of ${total.toLocaleString()} emails`;

          // Calculate and display estimated time remaining
          if (current > 0 && scanStartTime) {
            const elapsed = (Date.now() - scanStartTime) / 1000; // seconds
            const rate = current / elapsed; // messages per second
            const remaining = total - current;
            const estimatedSeconds = remaining / rate;

            const timeRemaining = document.getElementById("timeRemaining");
            if (estimatedSeconds > 60) {
              const minutes = Math.ceil(estimatedSeconds / 60);
              timeRemaining.textContent = `‚è±Ô∏è About ${minutes} minute${minutes !== 1 ? "s" : ""} remaining`;
            } else if (estimatedSeconds > 0) {
              const seconds = Math.ceil(estimatedSeconds);
              timeRemaining.textContent = `‚è±Ô∏è About ${seconds} second${seconds !== 1 ? "s" : ""} remaining`;
            } else {
              timeRemaining.textContent = "‚è±Ô∏è Almost done...";
            }
          }
        }

        async function showSubscriptionDetails(groupId, event) {
          // Don't trigger when clicking checkbox
          if (
            event &&
            (event.target.tagName === "INPUT" ||
              event.target.type === "checkbox")
          ) {
            return;
          }

          try {
            const resp = await fetch(`/subscription_details/${groupId}`);
            const data = await resp.json();

            if (data.ok) {
              const urlList =
                data.unsubscribe_urls.length > 0
                  ? data.unsubscribe_urls
                      .map(
                        (url) =>
                          `<div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 6px; word-break: break-all;"><a href="${url}" target="_blank" style="color: #667eea; text-decoration: underline;">${url}</a></div>`,
                      )
                      .join("")
                  : '<p style="color: #6c757d;">No unsubscribe URLs found. This subscription may not support automatic unsubscription.</p>';

              const message = `
                <div style="text-align: left;">
                  <p style="margin-bottom: 15px;"><strong>Sender:</strong> ${data.group.sender_name || data.group.sender_domain}</p>
                  <p style="margin-bottom: 15px;"><strong>Emails Received:</strong> ${data.group.frequency_score}</p>
                  <p style="margin-bottom: 10px; font-weight: 600;">Available Unsubscribe URLs:</p>
                  ${urlList}
                  <p style="margin-top: 15px; color: #6c757d; font-size: 0.9em;">Use the "Unsubscribe Selected" button to automatically unsubscribe, or click the links above to manually unsubscribe.</p>
                </div>
              `;

              showModal(
                "üìß Subscription Details",
                message,
                null, // No confirm action, just informational
              );
            } else {
              showToast("Failed to load details", "error");
            }
          } catch (err) {
            showToast(`Network error: ${err.message}`, "error");
          }
        }
      </script>
    </div>

    <!-- Toast Container -->
    <div id="toast" class="toast"></div>

    <!-- Modal -->
    <div
      id="modalOverlay"
      class="modal-overlay"
      onclick="if (event.target === this) closeModal();"
    >
      <div class="modal">
        <div class="modal-title" id="modalTitle"></div>
        <div class="modal-message" id="modalMessage"></div>
        <div class="modal-buttons">
          <button class="modal-btn modal-btn-cancel" onclick="closeModal()">
            Cancel
          </button>
          <button
            class="modal-btn modal-btn-confirm"
            id="modalConfirmBtn"
            onclick="confirmModal()"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>

    <!-- Scanning Overlay -->
    <div id="scanningOverlay" class="scanning-overlay">
      <div class="scanning-content">
        <div class="spinner"></div>
        <div class="scanning-text">üîç Scanning Your Mailbox</div>
        <div class="scanning-subtitle">
          This may take a few minutes. Please don't close this window.
        </div>
        <div class="progress-container">
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill" style="width: 0%">
              0%
            </div>
          </div>
          <div class="progress-stats">
            <div id="progressText">Starting scan...</div>
            <div id="timeRemaining" class="time-remaining"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Toast notification system
      function showToast(message, type = "info") {
        const toast = document.getElementById("toast");
        const icons = {
          success: "‚úì",
          error: "‚úó",
          info: "‚Ñπ",
        };
        toast.innerHTML = `
          <span class="toast-icon">${icons[type] || icons.info}</span>
          <span class="toast-message">${message}</span>
        `;
        toast.className = `toast ${type} show`;
        setTimeout(() => {
          toast.classList.remove("show");
        }, 4000);
      }

      // Modal system
      let modalCallback = null;

      function showModal(title, message, onConfirm) {
        document.getElementById("modalTitle").innerHTML = title;
        const messageEl = document.getElementById("modalMessage");

        // Check if message contains HTML
        if (message.includes("<")) {
          messageEl.innerHTML = message;
        } else {
          messageEl.textContent = message;
        }

        document.getElementById("modalOverlay").classList.add("show");
        modalCallback = onConfirm;

        // Hide confirm button if no callback (informational modal)
        const confirmBtn = document.querySelector(".modal-btn-confirm");
        if (confirmBtn) {
          confirmBtn.style.display = onConfirm ? "inline-block" : "none";
        }

        // Add keyboard support
        document.addEventListener("keydown", handleModalKeydown);
      }

      function closeModal() {
        document.getElementById("modalOverlay").classList.remove("show");
        document.removeEventListener("keydown", handleModalKeydown);
        modalCallback = null;
      }

      function handleModalKeydown(e) {
        if (e.key === "Escape") closeModal();
        if (e.key === "Enter") confirmModal();
      }

      function confirmModal() {
        const callback = modalCallback;
        closeModal();
        if (callback) callback();
      }

      // Scanning overlay
      function showScanning() {
        document.getElementById("scanningOverlay").classList.add("show");
        // Reset progress display
        document.getElementById("progressFill").style.width = "0%";
        document.getElementById("progressFill").textContent = "0%";
        document.getElementById("progressText").textContent =
          "Starting scan...";
        document.getElementById("timeRemaining").textContent = "";
      }

      function hideScanning() {
        document.getElementById("scanningOverlay").classList.remove("show");
        if (pollInterval) {
          clearInterval(pollInterval);
          pollInterval = null;
        }
      }
    </script>
  </body>
</html>
